# Pyrog Client

[![Arkhn](https://img.shields.io/badge/ARKHN-PRODUCT-000000.svg?style=for-the-badge&logo=data:image/png;base64,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)](https://arkhn.org/)
[![GitHub license](https://img.shields.io/badge/LICENSE-APACHE2-blue.svg?style=for-the-badge)](https://github.com/arkhn/pyrog-client/blob/master/LICENSE)
![CircleCI branch](https://img.shields.io/circleci/project/github/arkhn/pyrog/master.svg?style=for-the-badge&logo=circleci)
[![Codecov branch](https://img.shields.io/codecov/c/github/arkhn/pyrog/master.svg?style=for-the-badge&logo=codecov)](https://codecov.io/gh/arkhn/pyrog/branch/master)

![code style: prettier](https://img.shields.io/badge/code_style-prettier-ff69b4.svg?style=for-the-badge)

Pyrog is a web application meant to help people build and share mappings from healthcare softwares / data sources to FHIR.

**Checkout the staging version here:**

- [https://pyrog.staging.arkhn.org](https://pyrog.staging.arkhn.org)

## Quick install

```
yarn install
yarn start
```

## Detailed installation

### Custom setup

`.env.template` contains env variables used by the application.
To launch the applicaiton with a custom setup, you need to modify it to point to a specific services. This is useful if you are working on the client part of Pyrog only and do not want to run a Pyrog server locally.
To use it, just save the new file as `.env` and execute `yarn start`.

Here is a brief explanation of the different variables:

- PORT: the port on which the application will run
- REACT_APP_HTTP_BACKEND_URL: url to the pyrog server to use. It can be local or you can use something like `https://staging.arkhn.com/pyrog-api`
- REACT_APP_RIVER_URL: url to river api. It can be local or you can use something like `https://staging.arkhn.com/river`
- REACT_APP_FHIR_API_URL: url to fhir api. It can be local or you can use something like `https://staging.arkhn.com/api`
- REACT_APP_CLIENT_ID: the id of the client known by hydra (oauth provider)
- REACT_APP_CLIENT_SECRET: the secret of the client known by hydra (oauth provider)
- REACT_APP_AUTH_URL: url to Hydra's "auth" route. It can be local or you can use something like `https://staging.arkhn.com/hydra/oauth2/auth`. Note that if you use a remote server, your client needs to be registered with the right configuration (redirect urls, etc.).
- REACT_APP_TOKEN_URL: url to Hydra's "token" route. It can be local or you can use something like `https://staging.arkhn.com/hydra/oauth2/token`. Note that if you use a remote server, your client needs to be registered.
- REACT_APP_REVOKE_URL: url to Hydra's "revoke" route. It can be local or you can use something like `https://staging.arkhn.com/hydra/oauth2/token`. Note that if you use a remote server, your client needs to be registered.
- REACT_APP_LOGOUT_URL: url to Hydra's "logout" route. It can be local or you can use something like `https://staging.arkhn.com/hydra/oauth2/logout`. Note that if you use a remote server, your client needs to be registered.
- REACT_APP_LOGIN_REDIRECT_URL: url where the user will be redirected after login. If you run the application locally, it should be something like `http://localhost:1729/pyrog/`.
- REACT_APP_LOGOUT_REDIRECT_URL: url where the user will be redirected after logout. If you run the application locally, it should be something like `http://localhost:1729/pyrog/login/`.

### Install dependencies

```
yarn install
```

### Run client

```
yarn start
```

### Building production version

```
yarn run build
```

This will create bundles and output them to `./dist/`. These files can then be exported to a distant production server running the application.

## Release

Each push (commits and/or tags) will publish a single image to the DockerHub registry.

Each image will have one or more docker tags, depending on the context:

- on every branch (including `master`), images have following tags:
  - the first 8 chars of the targetted commit hash,
  - the branch name, with `/` replaced by `-`. For instance the branch `jd/fix/1` will have the `jd-fix-1` tag on DockerHub.
- on `master`, images have **additional** tags:
  - the version, only if the push is a tag (i.e. `git push --tags app/<version>`),
  - the `latest` tag, for the most recent pushed tag.

## Versioning of `pyrog-client`

The app must follow a [**semantic versioning**](https://semver.org/).

## Publishing a new release of `pyrog-client`

### 1. Tag the target commit (on `master`)

        git tag app/vX.Y.Z [<commit-sha>]

Tags for the `pyrog-client` should be prefixed with `app`. For instance, use `app/v1.1.0` if you want to publish the `v1.1.0` version of the `pyrog-client` on DockerHub.

### 2. Push the tag

        git push --tags app/vX.Y.Z

Providing that the CI workflow is successful (which should always be the case on `master`...), a new image will soon be available on DockerHub with the specified tag.

### 3. Pull the tagged image

        docker pull arkhn/pyrog-client:vX.Y.Z

## Code organisation

### Webpack

The webpack config file is located at `./webpack.config.js`. It mainly calls two files: `./src/index.html` and `./src/application/app.tsx` which are the root files to all other files of the application.

### Redux

Redux is used to manage the application's state.

- All Redux actions, reducers and middlewares are located at `./src/application/{actions, middlewares, reducers}/`.
- Reducers are combined in `./src/application/reducers/mainReducer.tsx`. They handle independent parts of the state.

I personally read this course so as to understand what Redux is and how it works: [https://github.com/happypoulp/redux-tutorial](https://github.com/happypoulp/redux-tutorial)

### React

React routes are defined in `./src/application/routes.tsx`. Links between React and Redux are made in `./src/application/app.tsx`.

- All React components are stored under `./src/application/components`.

## Start contributing

We have reported several issues with the label `Good first issue` which can be a good way to start! Also of course, feel free to contact us on Slack in you have trouble with the project.

If you're enthusiastic about our project, :star: it to show your support! :heart:
