# Migration `20201001154111-rm-passwords`

This migration has been generated by Jasopaum at 10/1/2020, 5:41:11 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "DatabaseType" AS ENUM ('POSTGRES', 'ORACLE', 'MSSQL');

CREATE TYPE "ConditionAction" AS ENUM ('INCLUDE', 'EXCLUDE');

CREATE TYPE "ConditionRelation" AS ENUM ('EQ', 'LT', 'LE', 'GE', 'GT', 'NULL', 'NOTNULL');

CREATE TYPE "Role" AS ENUM ('ADMIN', 'USER');

CREATE TYPE "SourceRole" AS ENUM ('READER', 'WRITER');

CREATE TABLE "pyrog"."Template" (
"id" text  NOT NULL ,
"name" text  NOT NULL ,
"updatedAt" timestamp(3)  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."Source" (
"id" text  NOT NULL ,
"name" text  NOT NULL ,
"version" text   ,
"template" text  NOT NULL ,
"updatedAt" timestamp(3)  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."Credential" (
"id" text  NOT NULL ,
"host" text  NOT NULL ,
"port" text  NOT NULL ,
"database" text  NOT NULL ,
"login" text  NOT NULL ,
"password" text  NOT NULL ,
"owner" text  NOT NULL DEFAULT E'',
"schema" text   ,
"model" "DatabaseType" NOT NULL ,
"source" text  NOT NULL ,
"updatedAt" timestamp(3)  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."Resource" (
"id" text  NOT NULL ,
"logicalReference" text  NOT NULL ,
"label" text   ,
"primaryKeyTable" text   ,
"primaryKeyColumn" text   ,
"definitionId" text  NOT NULL ,
"source" text  NOT NULL ,
"updatedAt" timestamp(3)  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."Filter" (
"id" text  NOT NULL ,
"relation" text  NOT NULL ,
"value" text  NOT NULL ,
"resource" text   ,
"sqlColumn" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."Attribute" (
"id" text  NOT NULL ,
"path" text  NOT NULL ,
"sliceName" text   ,
"definitionId" text  NOT NULL ,
"resource" text   ,
"updatedAt" timestamp(3)  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."Comment" (
"id" text  NOT NULL ,
"content" text  NOT NULL ,
"validation" boolean  NOT NULL DEFAULT false,
"author" text  NOT NULL ,
"attribute" text   ,
"updatedAt" timestamp(3)  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."InputGroup" (
"id" text  NOT NULL ,
"mergingScript" text   ,
"attributeId" text   ,
"updatedAt" timestamp(3)  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."Input" (
"id" text  NOT NULL ,
"script" text   ,
"conceptMapId" text   ,
"staticValue" text   ,
"sqlValue" text   ,
"inputGroupId" text   ,
"updatedAt" timestamp(3)  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."Column" (
"id" text  NOT NULL ,
"table" text   ,
"column" text   ,
"join" text   ,
"updatedAt" timestamp(3)  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."Join" (
"id" text  NOT NULL ,
"column" text   ,
"updatedAt" timestamp(3)  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."Condition" (
"id" text  NOT NULL ,
"action" "ConditionAction"  ,
"column" text   ,
"relation" "ConditionRelation" NOT NULL DEFAULT E'EQ',
"value" text   ,
"inputGroup" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."User" (
"id" text  NOT NULL ,
"email" text  NOT NULL ,
"name" text  NOT NULL ,
"role" "Role" NOT NULL DEFAULT E'USER',
"updatedAt" timestamp(3)  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id"))

CREATE TABLE "pyrog"."AccessControl" (
"id" text  NOT NULL ,
"role" "SourceRole" NOT NULL ,
"user" text  NOT NULL ,
"source" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "Template.name_unique" ON "pyrog"."Template"("name")

CREATE UNIQUE INDEX "Source_templateId_name" ON "pyrog"."Source"("template","name")

CREATE UNIQUE INDEX "Credential_source" ON "pyrog"."Credential"("source")

CREATE UNIQUE INDEX "Filter_sqlColumn" ON "pyrog"."Filter"("sqlColumn")

CREATE UNIQUE INDEX "Input_sqlValue" ON "pyrog"."Input"("sqlValue")

CREATE UNIQUE INDEX "Condition_column" ON "pyrog"."Condition"("column")

CREATE UNIQUE INDEX "User.email_unique" ON "pyrog"."User"("email")

CREATE UNIQUE INDEX "AccessControl_user_source" ON "pyrog"."AccessControl"("user","source")

ALTER TABLE "pyrog"."Source" ADD FOREIGN KEY ("template")REFERENCES "pyrog"."Template"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "pyrog"."Credential" ADD FOREIGN KEY ("source")REFERENCES "pyrog"."Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "pyrog"."Resource" ADD FOREIGN KEY ("source")REFERENCES "pyrog"."Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "pyrog"."Filter" ADD FOREIGN KEY ("resource")REFERENCES "pyrog"."Resource"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "pyrog"."Filter" ADD FOREIGN KEY ("sqlColumn")REFERENCES "pyrog"."Column"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "pyrog"."Attribute" ADD FOREIGN KEY ("resource")REFERENCES "pyrog"."Resource"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "pyrog"."Comment" ADD FOREIGN KEY ("author")REFERENCES "pyrog"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "pyrog"."Comment" ADD FOREIGN KEY ("attribute")REFERENCES "pyrog"."Attribute"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "pyrog"."InputGroup" ADD FOREIGN KEY ("attributeId")REFERENCES "pyrog"."Attribute"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "pyrog"."Input" ADD FOREIGN KEY ("sqlValue")REFERENCES "pyrog"."Column"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "pyrog"."Input" ADD FOREIGN KEY ("inputGroupId")REFERENCES "pyrog"."InputGroup"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "pyrog"."Column" ADD FOREIGN KEY ("join")REFERENCES "pyrog"."Join"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "pyrog"."Join" ADD FOREIGN KEY ("column")REFERENCES "pyrog"."Column"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "pyrog"."Condition" ADD FOREIGN KEY ("column")REFERENCES "pyrog"."Column"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "pyrog"."Condition" ADD FOREIGN KEY ("inputGroup")REFERENCES "pyrog"."InputGroup"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "pyrog"."AccessControl" ADD FOREIGN KEY ("user")REFERENCES "pyrog"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "pyrog"."AccessControl" ADD FOREIGN KEY ("source")REFERENCES "pyrog"."Source"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200831134344-default-logical-reference..20201001154111-rm-passwords
--- datamodel.dml
+++ datamodel.dml
@@ -4,9 +4,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 // One per software (Chimio, Crossway, etc)
 model Template {
@@ -192,9 +192,8 @@
 model User {
   id            String          @default(cuid()) @id
   email         String          @unique
   name          String
-  password      String
   role          Role            @default(USER)
   Comment       Comment[]
   AccessControl AccessControl[]
   updatedAt     DateTime        @updatedAt
```


