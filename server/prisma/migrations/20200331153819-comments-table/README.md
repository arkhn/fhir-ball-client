# Migration `20200331153819-comments-table`

This migration has been generated by simonvadee at 3/31/2020, 3:38:19 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "pyrog"."Comment" (
    "attribute" text   ,
    "author" text  NOT NULL ,
    "content" text  NOT NULL DEFAULT '',
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

ALTER TABLE "pyrog"."Attribute" DROP COLUMN "comments";

ALTER TABLE "pyrog"."Comment" ADD FOREIGN KEY ("attribute")REFERENCES "pyrog"."Attribute"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "pyrog"."Comment" ADD FOREIGN KEY ("author")REFERENCES "pyrog"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200327170316-unique-constraints..20200331153819-comments-table
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRES_URL")
 }
 // One per software (Chimio, Crossway, etc)
 model Template {
@@ -82,17 +82,27 @@
   id            String  @default(cuid()) @id
   path          String
   definitionId  String
   mergingScript String?
-  comments      String?
+  comments      Comment[]
   inputs   Input[]
   resource Resource?
   updatedAt DateTime @updatedAt
   createdAt DateTime @default(now())
 }
+model Comment {
+  id            String  @default(cuid()) @id
+
+  author User
+  content String
+  
+  updatedAt DateTime @updatedAt
+  createdAt DateTime @default(now())
+}
+
 model Input {
   id           String    @default(cuid()) @id
   // Sql column containing the value
   sqlValue     Column?   @relation(references: [id])
```


