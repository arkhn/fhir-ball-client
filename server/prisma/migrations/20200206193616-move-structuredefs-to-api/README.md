# Migration `20200206193616-move-structuredefs-to-api`

This migration has been generated by simonvadee at 2/6/2020, 7:36:16 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "pyrog"."Resource" DROP COLUMN "definition",
ADD COLUMN "definitionId" text  NOT NULL DEFAULT '' ;

DROP TABLE "pyrog"."StructureDefinition";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200120163303-flatten-attributes..20200206193616-move-structuredefs-to-api
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRES_URL")
 }
 // One per software (Chimio, Crossway, etc)
 model Template {
@@ -48,53 +48,19 @@
   updatedAt DateTime @updatedAt
   createdAt DateTime @default(now())
 }
-// TODO: dashes are not supported in enums
-// enum FhirKind {
-//   logical
-//   primitive-type
-//   complex-type
-//   resource
-// }
-
-enum FhirDerivation {
-  constraint
-  specialization
-}
-
-model StructureDefinition {
-  id          String          @id
-  name        String
-  // eg: FRPatient
-  type        String
-  // the type the structure describes. eg: Patient
-  description String
-  // eg: "represents a french patient"
-  author      String
-  // eg: HL7, Interop'Sant√©, Arkhn...
-  kind        String
-  // resource | primitive | complex | logical
-  derivation  FhirDerivation?
-  // constraint || specialization
-  content     String
-  // raw StructureDefiniton
-
-  updatedAt DateTime @updatedAt
-  createdAt DateTime @default(now())
-}
-
 model Resource {
   id    String  @default(cuid()) @id
   label String?
   primaryKeyOwner  String?
   primaryKeyTable  String?
   primaryKeyColumn String?
-  attributes Attribute[]
-  definition StructureDefinition?
-  source     Source
+  attributes   Attribute[]
+  definitionId String
+  source       Source
   updatedAt DateTime @updatedAt
   createdAt DateTime @default(now())
 }
```
