# Migration `20200120163303-flatten-attributes`

This migration has been generated by simonvadee at 1/20/2020, 4:33:03 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "pyrog"."Resource" DROP COLUMN "fhirType",
DROP COLUMN "profile";

ALTER TABLE "pyrog"."Attribute" DROP COLUMN "description",
DROP COLUMN "fhirType",
DROP COLUMN "isArray",
DROP COLUMN "isRequired",
DROP COLUMN "name",
DROP COLUMN "parent",
ADD COLUMN "path" text  NOT NULL DEFAULT '' ;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200117183910-structuredefinition..20200120163303-flatten-attributes
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRES_URL")
 }
 // One per software (Chimio, Crossway, etc)
 model Template {
@@ -83,42 +83,30 @@
   createdAt DateTime @default(now())
 }
 model Resource {
-  id               String      @default(cuid()) @id
-  label            String?
-  profile          String?
-  fhirType         String
+  id    String  @default(cuid()) @id
+  label String?
+
   primaryKeyOwner  String?
   primaryKeyTable  String?
   primaryKeyColumn String?
-  attributes       Attribute[] @relation(onDelete: CASCADE)
+  attributes Attribute[]          @relation(onDelete: CASCADE)
   definition StructureDefinition?
+  source     Source
-  // Parent
-  source Source
-
   updatedAt DateTime @updatedAt
   createdAt DateTime @default(now())
 }
 model Attribute {
   id            String  @default(cuid()) @id
+  path          String
   mergingScript String?
-  isArray       Boolean @default(false)
-  isRequired    Boolean @default(false)
-  name          String
-  fhirType      String
-  description   String?
   comments      String?
-  // Children input columns
-  inputs   Input[]     @relation(onDelete: CASCADE)
-  // Children attributes
-  children Attribute[] @relation(name: "AttributeToAttributes", onDelete: CASCADE)
-  // Parent attribute or resource
-  parent   Attribute?  @relation(name: "AttributeToAttributes")
+  inputs   Input[]   @relation(onDelete: CASCADE)
   resource Resource?
   updatedAt DateTime @updatedAt
   createdAt DateTime @default(now())
```


