# Migration `20200224185941-resource_filters`

This migration has been generated by Jasopaum at 2/24/2020, 6:59:41 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "pyrog"."Filter" (
  "id" text  NOT NULL  ,
  "relation" text  NOT NULL DEFAULT '' ,
  "resource" text    REFERENCES "pyrog"."Resource"("id") ON DELETE SET NULL,
  "sqlColumn" text  NOT NULL  REFERENCES "pyrog"."Column"("id") ON DELETE RESTRICT,
  "value" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200218162146-concept-maps..20200224185941-resource_filters
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRES_URL")
 }
 // One per software (Chimio, Crossway, etc)
 model Template {
@@ -56,16 +56,27 @@
   primaryKeyOwner  String?
   primaryKeyTable  String?
   primaryKeyColumn String?
+  // filters on db to avoid processing all the DB
+  filters Filter[]
+
   attributes   Attribute[] @relation(onDelete: CASCADE)
   definitionId String
   source       Source
   updatedAt DateTime @updatedAt
   createdAt DateTime @default(now())
 }
+model Filter {
+  id String @default(cuid()) @id
+
+  sqlColumn Column
+  relation  String
+  value     String
+}
+
 model Attribute {
   id            String  @default(cuid()) @id
   path          String
   mergingScript String?
```


