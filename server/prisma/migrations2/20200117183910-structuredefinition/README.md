# Migration `20200117183910-structuredefinition`

This migration has been generated by simonvadee at 1/17/2020, 6:39:10 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "pyrog"."StructureDefinition" (
  "author" text  NOT NULL DEFAULT '' ,
  "content" text  NOT NULL DEFAULT '' ,
  "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "derivation" text    ,
  "description" text  NOT NULL DEFAULT '' ,
  "id" text  NOT NULL  ,
  "kind" text  NOT NULL DEFAULT '' ,
  "name" text  NOT NULL DEFAULT '' ,
  "type" text  NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

ALTER TABLE "pyrog"."Resource" ADD COLUMN "definition" text    REFERENCES "pyrog"."StructureDefinition"("id") ON DELETE SET NULL;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200108172036-unique_source_name..20200117183910-structuredefinition
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRES_URL")
 }
 // One per software (Chimio, Crossway, etc)
 model Template {
@@ -29,8 +29,12 @@
   updatedAt DateTime @updatedAt
   createdAt DateTime @default(now())
 }
+enum DatabaseType {
+  POSTGRES
+}
+
 model Credential {
   id       String       @default(cuid()) @id
   host     String
   port     String
@@ -44,12 +48,42 @@
   updatedAt DateTime @updatedAt
   createdAt DateTime @default(now())
 }
-enum DatabaseType {
-  POSTGRES
+// TODO: dashes are not supported in enums
+// enum FhirKind {
+//   logical
+//   primitive-type
+//   complex-type
+//   resource
+// }
+
+enum FhirDerivation {
+  constraint
+  specialization
 }
+model StructureDefinition {
+  id          String          @id
+  name        String
+  // eg: FRPatient
+  type        String
+  // the type the structure describes. eg: Patient
+  description String
+  // eg: "represents a french patient"
+  author      String
+  // eg: HL7, Interop'Sant√©, Arkhn...
+  kind        String
+  // resource | primitive | complex | logical
+  derivation  FhirDerivation?
+  // constraint || specialization
+  content     String
+  // raw StructureDefiniton
+
+  updatedAt DateTime @updatedAt
+  createdAt DateTime @default(now())
+}
+
 model Resource {
   id               String      @default(cuid()) @id
   label            String?
   profile          String?
@@ -57,31 +91,35 @@
   primaryKeyOwner  String?
   primaryKeyTable  String?
   primaryKeyColumn String?
   attributes       Attribute[]
+
+  definition StructureDefinition?
+
   // Parent
-  source           Source
+  source Source
   updatedAt DateTime @updatedAt
   createdAt DateTime @default(now())
 }
 model Attribute {
-  id            String      @default(cuid()) @id
+  id            String  @default(cuid()) @id
   mergingScript String?
-  isArray       Boolean     @default(false)
-  isRequired    Boolean     @default(false)
+  isArray       Boolean @default(false)
+  isRequired    Boolean @default(false)
   name          String
   fhirType      String
   description   String?
   comments      String?
+
   // Children input columns
-  inputs        Input[]
+  inputs   Input[]
   // Children attributes
-  children      Attribute[] @relation(name: "AttributeToAttributes")
+  children Attribute[] @relation(name: "AttributeToAttributes")
   // Parent attribute or resource
-  parent        Attribute?  @relation(name: "AttributeToAttributes")
-  resource      Resource?
+  parent   Attribute?  @relation(name: "AttributeToAttributes")
+  resource Resource?
   updatedAt DateTime @updatedAt
   createdAt DateTime @default(now())
 }
```
